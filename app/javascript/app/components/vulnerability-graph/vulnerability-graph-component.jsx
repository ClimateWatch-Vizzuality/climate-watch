import React, { PureComponent } from 'react';
import PropTypes from 'prop-types';
import cx from 'classnames';
import CircularChart from 'components/circular-chart';
import NoContent from 'components/no-content';
import InfoButton from 'components/button/info-button';
import styles from './vulnerability-graph-styles.scss';

class VulnerabilityGraph extends PureComponent {
  // eslint-disable-line react/prefer-stateless-function

  handleInfoClick = slug => {
    const { setModalMetadata } = this.props;
    setModalMetadata({
      slug,
      open: true
    });
  };

  renderCircular() {
    const { sectionData, countriesCount } = this.props;
    const value =
      sectionData.data && Math.floor(sectionData.data.value * 10) / 10;
    return sectionData.data ? (
      <div className={styles.circularChartContainer}>
        <InfoButton
          className={cx(styles.pullRight, styles.noPadding)}
          infoOpen={false}
          handleInfoClick={() => this.handleInfoClick(sectionData.slug)}
        />
        <CircularChart value={value} />
        <div className={styles.absoluteRank}>
          <span>{sectionData.data.rank.absolute}</span>
          <span className={styles.countriesNumber}> of {countriesCount}</span>
        </div>
      </div>
    ) : (
      <NoContent message={'No data'} />
    );
  }

  renderLine() {
    const { sectionData, countriesCount } = this.props;
    const value =
      sectionData.data && Math.floor(sectionData.data.value * 10) / 10;
    const riskValue =
      sectionData.data && parseInt(sectionData.data.rank.absolute, 10) * 100;
    const riskAbsoluteValue = riskValue / countriesCount;
    return sectionData.data ? (
      <div className={styles.lineChartContainer}>
        <InfoButton
          className={[styles.pullRight, styles.noPadding]}
          infoOpen={false}
          handleInfoClick={() => this.handleInfoClick(sectionData.slug)}
        />
        <div className={styles.riskValue}>{value}</div>
        <div className={styles.riskMeter}>
          <div
            className={styles.riskMarker}
            style={{ left: `${riskAbsoluteValue}%` }}
          >
            <div className={styles.riskAbsoluteValue}>
              {sectionData.data.rank.absolute}
              <span className={styles.countriesNumber}>
                {' '}
                of {countriesCount}
              </span>
            </div>
          </div>
          {Array(10)
            .fill()
            .map((_, i) => (
              <div
                key={i} // eslint-disable-line react/no-array-index-key
                className={cx(styles.riskTick, styles[`meter-${i + 1}`])}
              />
            ))}
        </div>
      </div>
    ) : (
      <NoContent message={'No data'} />
    );
  }

  renderList() {
    const { sectionData } = this.props;
    return (
      <div className={styles.listContainer}>
        <div className={styles.list}>
          {sectionData.data.map(
            hazard =>
              (hazard === 'No data' ? (
                <NoContent key={'no-data'} message={'No data'} />
              ) : (
                <div key={hazard}>{hazard}</div>
              ))
          )}
        </div>
        <a
          className={styles.learnMore}
          target={'_blank'}
          href={sectionData.metadataUrl}
        >
          Learn More
        </a>
      </div>
    );
  }

  render() {
    const { sectionData } = this.props;
    switch (sectionData.sectionType) {
      case 'CIRCULAR':
        return this.renderCircular();
      case 'LINE':
        return this.renderLine();
      case 'LIST':
        return this.renderList();
      default:
        return null;
    }
  }
}

VulnerabilityGraph.propTypes = {
  sectionData: PropTypes.object,
  setModalMetadata: PropTypes.func.isRequired,
  countriesCount: PropTypes.number.isRequired
};

export default VulnerabilityGraph;

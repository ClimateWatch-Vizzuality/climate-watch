import { createElement } from 'react';
import { withRouter } from 'react-router-dom';
import { connect } from 'react-redux';
import { CLIMATE_VULNERABILITY_DEFINITIONS } from 'data/constants';
import { actions } from 'components/modal-metadata';
import Component from './country-climate-vulnerability-component';
import {
  getSectionData,
  getQueryIsos,
  getCountryName,
  getMaximumCountries
} from './country-climate-vulnerability-selectors';

const mapStateToProps = (state, { match, location }) => {
  const iso = match.params.iso;
  const search = location.search;
  const countriesData = state.countries.data;
  const { adaptations } = state;
  const climateVulnerability = {
    ...state,
    iso,
    adaptations,
    search,
    countriesData
  };
  const definitions = CLIMATE_VULNERABILITY_DEFINITIONS;

  return {
    sectionData: getSectionData(climateVulnerability),
    countries: getQueryIsos(search),
    maximumCountries: getMaximumCountries(climateVulnerability),
    countryName: getCountryName(climateVulnerability),
    ready: adaptations.loaded,
    definitions,
    iso
  };
};

const CountryClimateVulnerability = props => {
  const { setModalMetadata } = props;

  const handleInfoClick = slug => {
    setModalMetadata({
      category: 'Climate Vulnerability and Readiness',
      slugs: slug,
      open: true
    });
  };

  return createElement(Component, { ...props, handleInfoClick });
};

export default withRouter(
  connect(mapStateToProps, actions)(CountryClimateVulnerability)
);

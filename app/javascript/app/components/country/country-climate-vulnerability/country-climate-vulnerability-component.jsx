/* eslint-disable no-confusing-arrow */
import React from 'react';
import Proptypes from 'prop-types';

import Card from 'components/card';
import VulnerabilityGraph from 'components/vulnerability-graph';
import CardGraph from 'components/card-graph';
import AdaptationsProvider from 'providers/adaptations-provider';
import Loading from 'components/loading';
import ReactTooltip from 'react-tooltip';
import AbbrReplace from 'components/abbr-replace';
import InfoButton from 'components/button/info-button';
import PreviousSubmissionIcon from 'components/previous-submission-icon';
import cardFullHeightTheme from 'styles/themes/card/card-full-height.scss';

import layout from 'styles/layout.scss';

import PrepCard from './prep-card';
import styles from './country-climate-vulnerability-styles.scss';
// import styles from './climate-vulnerability-styles.scss';

const FEATURE_COUNTRY_CHANGES = process.env.FEATURE_COUNTRY_CHANGES === 'true';

function CountryClimateVulnerability(props) {
  const {
    sectionData,
    definitions,
    countries,
    ready,
    countryName,
    maximumCountries,
    iso,
    handleInfoClick
  } = props;

  const infoButton = slug => (
    <InfoButton
      className={styles.infoBtn}
      infoOpen={false}
      handleInfoClick={() => handleInfoClick(slug)}
    />
  );

  const renderLegacyContent = () => (
    <React.Fragment>
      <div className={styles.header}>
        <div className={styles.titleContainer}>
          <h3 className={styles.title}>Climate Vulnerability and Readiness</h3>
          <AbbrReplace>
            <div className={styles.descriptionContainer}>
              <div className="grid-column-item">
                The poor are disproportionately affected by
                <span
                  className={styles.tooltipTrigger}
                  data-tip={definitions.climateRisks}
                >
                  {' '}
                  climate risks{' '}
                </span>
                such as sea level rise, increases in temperature and more
                erratic rainfall, often experienced as more frequent and extreme
                weather events such as storms, floods, and droughts. Because the
                poor are more
                <span
                  className={styles.tooltipTrigger}
                  data-tip={definitions.exposed}
                >
                  {' '}
                  exposed{' '}
                </span>
                and
                <span
                  className={styles.tooltipTrigger}
                  data-tip={definitions.sensitive}
                >
                  {' '}
                  sensitive{' '}
                </span>
                to such impacts and generally have lower capacity and fewer
                resources with which to adapt, they are more
                <span
                  className={styles.tooltipTrigger}
                  data-tip={definitions.vulnerable}
                >
                  {' '}
                  vulnerable{' '}
                </span>
                to climate change.
              </div>
              <div className="grid-column-item">
                Their vulnerability makes them less
                <span
                  className={styles.tooltipTrigger}
                  data-tip={definitions.resilient}
                >
                  {' '}
                  resilient{' '}
                </span>
                to the impacts of climate change. Supporting the inclusion of
                the poor in planning and implementing adaptation actions and
                ensuring that a greater share of adaptation funding reaches
                local communities can improve their{' '}
                <span
                  className={styles.tooltipTrigger}
                  data-tip={definitions.ready}
                >
                  readiness
                </span>{' '}
                to{' '}
                <span
                  className={styles.tooltipTrigger}
                  data-tip={definitions.adapt}
                >
                  adapt
                </span>{' '}
                to climate change and reduce poverty.
              </div>
            </div>
          </AbbrReplace>
        </div>
        <ReactTooltip className={styles.tooltip} />
      </div>
      {!ready ? (
        <Loading light className={styles.paddedBottom} />
      ) : (
        <div className="grid-column-item">
          <div className={styles.cards}>
            {sectionData &&
              sectionData.map(section => (
                <div className={styles.card} key={section.slug}>
                  {section.sectionType === 'LINK' ? (
                    <PrepCard className={styles.prepCard} />
                  ) : (
                    <Card
                      title={section.title}
                      subtitle={section.subtitle}
                      contentFirst
                    >
                      <VulnerabilityGraph
                        sectionData={section}
                        countries={countries}
                      />
                    </Card>
                  )}
                </div>
              ))}
          </div>
        </div>
      )}
    </React.Fragment>
  );

  const renderContent = () => {
    if (FEATURE_COUNTRY_CHANGES) {
      const vulnerabilitySection = sectionData && sectionData.vulnerability;
      const snapshotsSection =
        sectionData && sectionData.snapshots && sectionData.snapshots.data;
      const readinessSection = sectionData && sectionData.readiness;
      const hazardsSection = sectionData && sectionData.hazards;

      return (
        <div>
          <div className={styles.header}>
            <div className={styles.titleContainer}>
              <h3 className={styles.title}>
                How vulnerable is {countryName} to climate risks?
              </h3>
              <AbbrReplace>
                <div className={styles.descriptionContainer}>
                  <div className="grid-column-item">
                    The poor are disproportionately affected by
                    <span
                      className={styles.tooltipTrigger}
                      data-tip={definitions.climateRisks}
                    >
                      {' '}
                      climate risks{' '}
                    </span>
                    such as sea level rise, increases in temperature and more
                    erratic rainfall, often experienced as more frequent and
                    extreme weather events such as storms, floods, and droughts.
                    Because the poor are more
                    <span
                      className={styles.tooltipTrigger}
                      data-tip={definitions.exposed}
                    >
                      {' '}
                      exposed{' '}
                    </span>
                    and
                    <span
                      className={styles.tooltipTrigger}
                      data-tip={definitions.sensitive}
                    >
                      {' '}
                      sensitive{' '}
                    </span>
                    to such impacts and generally have lower capacity and fewer
                    resources with which to adapt, they are more
                    <span
                      className={styles.tooltipTrigger}
                      data-tip={definitions.vulnerable}
                    >
                      {' '}
                      vulnerable{' '}
                    </span>
                    to climate change.
                  </div>
                  <div className="grid-column-item">
                    Their vulnerability makes them less
                    <span
                      className={styles.tooltipTrigger}
                      data-tip={definitions.resilient}
                    >
                      {' '}
                      resilient{' '}
                    </span>
                    to the impacts of climate change. Supporting the inclusion
                    of the poor in planning and implementing adaptation actions
                    and ensuring that a greater share of adaptation funding
                    reaches local communities can improve their{' '}
                    <span
                      className={styles.tooltipTrigger}
                      data-tip={definitions.ready}
                    >
                      readiness
                    </span>{' '}
                    to{' '}
                    <span
                      className={styles.tooltipTrigger}
                      data-tip={definitions.adapt}
                    >
                      adapt
                    </span>{' '}
                    to climate change and reduce poverty.
                  </div>
                </div>
              </AbbrReplace>
              <div className={styles.cards}>
                {' '}
                <Card
                  title="NDC-Adaptation Snapshots"
                  contentFirst
                  info={infoButton(vulnerabilitySection.metadata)}
                  theme={cardFullHeightTheme}
                >
                  <div className={styles.adaptationIndicators}>
                    {snapshotsSection &&
                      snapshotsSection.map(i => (
                        <div className={styles.adaptationIndicator}>
                          <PreviousSubmissionIcon
                            value={i.values[0].value}
                            className={styles.valueIcon}
                            tooltipId="submission-info"
                          />
                          <div>{i.name}</div>
                          <ReactTooltip id="submission-info" />
                        </div>
                      ))}
                  </div>
                </Card>
                <div className={styles.scoreCards}>
                  <Card
                    title="NDC-GAIN vulnerability score"
                    subtitle="Lower score indicates less vulnerability"
                    contentFirst
                    info={infoButton(vulnerabilitySection.metadata)}
                  >
                    {vulnerabilitySection && (
                      <CardGraph
                        sectionData={vulnerabilitySection}
                        countries={countries}
                        maximumCountries={maximumCountries}
                        noInfo
                        type="RANK"
                        iso={iso}
                        theme={{ data: styles.data }}
                      />
                    )}
                  </Card>
                  <Card
                    title="NDC-GAIN readiness score"
                    subtitle="Higher score indicates high level of readiness"
                    contentFirst
                    info={infoButton(readinessSection.metadata)}
                  >
                    {readinessSection && (
                      <CardGraph
                        sectionData={readinessSection}
                        countries={countries}
                        noInfo
                        maximumCountries={maximumCountries}
                        type="RANK"
                        iso={iso}
                      />
                    )}
                  </Card>
                </div>
                <Card
                  title="Natural Hazard Ocurrence"
                  contentFirst
                  info={infoButton(hazardsSection.metadata)}
                  theme={{ data: styles.data }}
                >
                  <CardGraph
                    sectionData={hazardsSection}
                    countries={countries}
                    noInfo
                    maximumCountries={maximumCountries}
                    type="PIE_CHART"
                    iso={iso}
                  />
                </Card>
              </div>
            </div>
            <ReactTooltip className={styles.tooltip} />
          </div>
        </div>
      );
    }
    return renderLegacyContent();
  };

  // eslint-disable-line react/prefer-stateless-function
  return (
    <div className={styles.wrapper}>
      <AdaptationsProvider />
      <div className={layout.content}>{renderContent()}</div>
    </div>
  );
}

CountryClimateVulnerability.propTypes = {
  sectionData: Proptypes.array,
  ready: Proptypes.bool,
  definitions: Proptypes.object.isRequired,
  countries: Proptypes.array,
  handleInfoClick: Proptypes.func.isRequired,
  countryName: Proptypes.string,
  iso: Proptypes.string,
  maximumCountries: Proptypes.number
};

export default CountryClimateVulnerability;
